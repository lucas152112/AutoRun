# 輸入欄位權限控制說明

## 功能目的

為了提供更好的使用者體驗和避免誤操作，程式實作了輸入欄位的權限控制機制。

## 行為說明

### 啟動時
- ? 顯示所有已儲存的排程項目在 Grid 中
- ? **不選中任何項目**
- ? **所有輸入欄位處於禁用狀態**（灰色，不可輸入）
- ? 「加入/更新」按鈕也處於禁用狀態

**受控制的欄位**:
- 名稱 (txtName)
- 程式 (txtExe)
- 瀏覽按鈕 (btnBrowse)
- 參數 (txtArgs)
- 時間 (dtpTime)
- 啟用 (chkEnabled)
- 每天 (chkEveryDay)
- 星期一∼星期日 (chkMon ~ chkSun)
- 加入/更新按鈕 (btnAddUpdate)

## 操作流程

### 情境 1: 新增排程項目

1. **點擊「新增」按鈕**
   - 所有輸入欄位**啟用**（變為可輸入）
   - 清空所有輸入內容
   - 設定預設值（時間 09:00、啟用?、每天?）
   - Grid 清除選擇

2. **輸入排程資料**
   - 填寫名稱、程式路徑、參數等
   - 調整時間和週期

3. **點擊「加入/更新」**
   - 驗證輸入（名稱、程式、週期必填）
   - 新增項目到 Grid
   - 自動儲存
   - 保持輸入欄位啟用狀態，並顯示剛新增的項目

### 情境 2: 編輯現有項目

1. **在 Grid 中點選一個項目**
   - 所有輸入欄位**啟用**
   - 載入該項目的資料到輸入欄位

2. **修改資料**
   - 更改任何需要修改的欄位

3. **點擊「加入/更新」**
   - 驗證輸入
   - 更新項目
   - 自動儲存
   - 保持選中該項目

### 情境 3: 刪除項目

1. **在 Grid 中點選要刪除的項目**
   - 輸入欄位啟用並顯示該項目資料

2. **點擊「刪除」按鈕**
   - 確認刪除對話框
   - 刪除項目
   - **所有輸入欄位禁用**
   - 清空輸入內容
   - Grid 清除選擇

### 情境 4: 取消操作

- **點擊 Grid 空白處**或按 Escape（如果 Grid 支援）
  - Grid 清除選擇
  - **所有輸入欄位禁用**
  - 保留當前輸入內容（不清空）

## 使用者體驗優勢

### 1. 防止誤操作
- 啟動時不會因為不小心輸入而修改到任何項目
- 清楚知道目前是否處於可輸入狀態

### 2. 清晰的視覺提示
- 禁用的欄位呈現灰色，明確表示不可操作
- 啟用的欄位恢復正常顏色，表示可以輸入

### 3. 明確的操作流程
- 新增：按「新增」→ 輸入 → 「加入/更新」
- 編輯：選擇項目 → 修改 → 「加入/更新」
- 刪除：選擇項目 → 「刪除」

### 4. 避免混淆
- 不會有「我現在是在新增還是編輯？」的疑問
- 有選中 Grid 項目 = 編輯模式
- 按了「新增」且沒有選中項目 = 新增模式

## 技術實作

### EnableInputs() 方法
```csharp
private void EnableInputs()
{
    txtName.Enabled = true;
    txtExe.Enabled = true;
    txtArgs.Enabled = true;
    btnBrowse.Enabled = true;
    dtpTime.Enabled = true;
    chkEnabled.Enabled = true;
    chkEveryDay.Enabled = true;
    
    // 星期選項根據「每天」的狀態決定
    var enableDays = !chkEveryDay.Checked;
    chkMon.Enabled = enableDays;
    chkTue.Enabled = enableDays;
    chkWed.Enabled = enableDays;
    chkThu.Enabled = enableDays;
    chkFri.Enabled = enableDays;
    chkSat.Enabled = enableDays;
    chkSun.Enabled = enableDays;
    
    btnAddUpdate.Enabled = true;
}
```

### DisableInputs() 方法
```csharp
private void DisableInputs()
{
    txtName.Enabled = false;
    txtExe.Enabled = false;
    txtArgs.Enabled = false;
    btnBrowse.Enabled = false;
    dtpTime.Enabled = false;
    chkEnabled.Enabled = false;
    chkEveryDay.Enabled = false;
    chkMon.Enabled = false;
    chkTue.Enabled = false;
    chkWed.Enabled = false;
    chkThu.Enabled = false;
    chkFri.Enabled = false;
    chkSat.Enabled = false;
    chkSun.Enabled = false;
    btnAddUpdate.Enabled = false;
}
```

### 調用時機

| 事件 | 動作 | 呼叫方法 |
|------|------|----------|
| Form_Load | 程式啟動 | `DisableInputs()` |
| btnNew_Click | 點擊新增按鈕 | `EnableInputs()` |
| dgvSchedules_SelectionChanged | 選中項目 | `EnableInputs()` |
| dgvSchedules_SelectionChanged | 取消選擇 | `DisableInputs()` |
| btnDelete_Click | 刪除項目後 | `DisableInputs()` |

## 未受控制的元件

以下元件不受此機制控制，始終保持可用：
- ? Grid（dgvSchedules）- 始終可以點選和查看
- ? 「新增」按鈕（btnNew）- 始終可以點擊
- ? 「刪除」按鈕（btnDelete）- 根據是否有選中項目
- ? 「存檔」按鈕（btnSave）- 始終可以點擊
- ? 「啟動排程器」核取方塊（chkRunScheduler）
- ? 系統設定（最小化至系統匣、開機啟動等）
- ? 執行紀錄（lstLog）

## 特殊情況處理

### 「每天」核取方塊的互動
當啟用輸入欄位時：
- 如果「每天」被勾選 → 個別星期選項自動禁用
- 如果「每天」未勾選 → 個別星期選項保持啟用

這是由 `chkEveryDay_CheckedChanged` 事件處理。

### 新增後立即編輯
新增項目並成功後：
- 輸入欄位**保持啟用**
- Grid 自動選中剛新增的項目
- 可以立即修改並再次點擊「加入/更新」

### 編輯後的狀態
更新項目後：
- 輸入欄位**保持啟用**
- Grid 保持選中該項目
- 可以繼續修改

## 使用建議

1. **想新增排程**: 點擊「新增」按鈕開始
2. **想修改排程**: 直接在 Grid 中點選要修改的項目
3. **想取消操作**: 點擊 Grid 空白處或選擇其他項目
4. **刪除後想新增**: 刪除項目後，點擊「新增」按鈕
5. **刪除後想編輯其他**: 刪除項目後，點選其他項目

## 版本資訊

- 實作版本: v1.2
- 實作日期: 2025-01-20
- 相關檔案: `Form1.cs`
