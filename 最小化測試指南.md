# 最小化功能測試驗證指南

## ? 已修正的問題

### 修正內容
使用 `ShowInTaskbar` 屬性確保視窗真正從工作列消失：

**Form1.cs - OnResize 方法**:
```csharp
protected override void OnResize(EventArgs e)
{
    base.OnResize(e);
    if (WindowState == FormWindowState.Minimized && chkMinToTray.Checked)
    {
        // 從工作列移除並隱藏視窗
        ShowInTaskbar = false;  // ← 關鍵：移除工作列圖示
        Hide();                  // ← 隱藏視窗
        
        // ...其他邏輯
    }
}
```

**Form1.cs - RestoreFromTray 方法**:
```csharp
private void RestoreFromTray()
{
    Show();
    ShowInTaskbar = true;  // ← 關鍵：恢復工作列圖示
    WindowState = FormWindowState.Normal;
    Activate();
}
```

## ?? 測試前準備

### 前提條件
1. ? 確保建置成功（已完成）
2. ? 停止目前的偵錯會話
3. ? 重新啟動應用程式

### 重要提醒
?? **必須勾選「最小化自動啟動排程」才會隱藏到托盤**
- 如果沒勾選，視窗會最小化到工作列（Windows 預設行為）
- 這是設計行為，不是 Bug

## ?? 測試步驟

### 測試 1: 基本最小化到托盤功能

#### 步驟：
1. **啟動應用程式**
   
2. **勾選「最小化自動啟動排程」**
   - 位置：主視窗右上方
   - 確認打勾 ?

3. **點擊視窗的最小化按鈕**（不是關閉按鈕）
   - 位置：視窗標題列右上角的「_」按鈕

4. **驗證結果**：
   - [ ] 視窗立即消失
   - [ ] 工作列上的程式圖示消失
   - [ ] 系統托盤（右下角時鐘附近）出現程式圖示
   - [ ] 顯示氣泡通知（持續 2 秒）

#### 預期氣泡通知內容：
如果排程器未運行：
```
標題：自動啟動排程器
內容：視窗已最小化到系統托盤
     排程器已自動啟動
```

如果排程器已運行：
```
標題：已最小化
內容：視窗已最小化到系統托盤
     排程器執行中
```

### 測試 2: 從托盤恢復視窗

#### 步驟：
1. **雙擊托盤圖示**
   
2. **驗證結果**：
   - [ ] 視窗重新顯示
   - [ ] 視窗狀態為正常（非最小化）
   - [ ] 工作列出現程式圖示
   - [ ] 視窗在最前面（Activate）

#### 替代方式：
1. **右鍵點擊托盤圖示**
2. **選擇「開啟視窗」**
3. **驗證結果同上**

### 測試 3: 托盤圖示資訊

#### 步驟：
1. **最小化到托盤後**
2. **滑鼠停留在托盤圖示上（不要點擊）**

3. **驗證提示內容**：
   ```
   排程器: 執行中
   共 X 個排程 (Y 個啟用)
   ```
   - X = 總排程數量
   - Y = 已啟用的排程數量

### 測試 4: 托盤選單功能

#### 步驟：
1. **最小化到托盤後**
2. **右鍵點擊托盤圖示**

3. **驗證選單項目**：
   - [ ] 「開啟視窗」
   - [ ] 「啟動排程器」或「停止排程器」（根據當前狀態）
   - [ ] 分隔線
   - [ ] 「退出」

4. **測試「啟動排程器」/「停止排程器」**：
   - 點擊後，選單文字應該切換
   - 托盤提示應該更新狀態

5. **測試「退出」**：
   - 應該關閉程式
   - 托盤圖示消失

### 測試 5: 未勾選「最小化自動啟動排程」

#### 步驟：
1. **取消勾選「最小化自動啟動排程」**
   
2. **點擊最小化按鈕**

3. **驗證結果**：
   - [ ] 視窗最小化到工作列（不是托盤）
   - [ ] 工作列仍有程式圖示
   - [ ] 點擊工作列圖示可以恢復視窗

#### 說明：
這是預期行為！**只有勾選「最小化自動啟動排程」才會隱藏到托盤。**

### 測試 6: 排程器自動啟動

#### 步驟：
1. **確保排程器已停止**（按鈕顯示「啟動排程器」）
   
2. **勾選「最小化自動啟動排程」**
   
3. **點擊最小化按鈕**

4. **從托盤恢復視窗**

5. **驗證結果**：
   - [ ] 按鈕顯示「停止排程」
   - [ ] 執行紀錄有「最小化到托盤 - 自動啟動排程器」
   - [ ] 托盤提示顯示「排程器: 執行中」

### 測試 7: 排程器已運行時最小化

#### 步驟：
1. **手動啟動排程器**（按鈕變成「停止排程」）
   
2. **勾選「最小化自動啟動排程」**
   
3. **點擊最小化按鈕**

4. **驗證結果**：
   - [ ] 視窗隱藏到托盤
   - [ ] 氣泡通知：「已最小化 - 排程器執行中」
   - [ ] 執行紀錄有「最小化到托盤 - 排程器已在運行中」
   - [ ] 排程器持續運行（不重複啟動）

## ?? 問題排查

### 問題 1: 點擊最小化後，工作列還有圖示

**可能原因**：
- 沒有勾選「最小化自動啟動排程」
- 程式沒有重新啟動（使用舊版本）

**解決方案**：
1. 確認「最小化自動啟動排程」已勾選 ?
2. 停止偵錯
3. 重新編譯
4. 重新啟動應用程式

### 問題 2: 找不到托盤圖示

**可能原因**：
- 托盤圖示被隱藏在「溢位區域」（^ 符號）

**解決方案**：
1. 點擊工作列右下角的「^」符號
2. 查看溢位區域中的圖示
3. 拖曳圖示到主托盤區域

### 問題 3: 雙擊托盤圖示沒反應

**可能原因**：
- 點擊速度太慢（被視為兩次單擊）
- 程式異常

**解決方案**：
1. 使用右鍵選單 → 「開啟視窗」
2. 檢查執行紀錄是否有錯誤訊息
3. 重新啟動應用程式

### 問題 4: 氣泡通知沒有顯示

**可能原因**：
- Windows 通知設定關閉
- 通知顯示時間太短

**解決方案**：
1. 檢查 Windows 設定 → 系統 → 通知
2. 確認應用程式通知已啟用
3. 通知會在 2 秒後自動消失（這是正常的）

## ? 驗證清單

完成所有測試後，確認：

- [ ] 勾選「最小化自動啟動排程」後，點擊最小化視窗消失
- [ ] 工作列圖示消失，只保留托盤圖示
- [ ] 托盤顯示氣泡通知
- [ ] 托盤提示顯示正確資訊
- [ ] 雙擊托盤圖示可以恢復視窗
- [ ] 右鍵選單功能正常
- [ ] 未勾選時，視窗正常最小化到工作列
- [ ] 排程器自動啟動功能正常

## ?? 預期 vs 實際

| 功能 | 預期行為 | 測試結果 | 備註 |
|------|----------|----------|------|
| 最小化隱藏視窗 | 視窗消失 | ? Pass / ? Fail | |
| 工作列圖示消失 | 圖示消失 | ? Pass / ? Fail | |
| 托盤圖示顯示 | 出現圖示 | ? Pass / ? Fail | |
| 氣泡通知 | 顯示 2 秒 | ? Pass / ? Fail | |
| 恢復視窗 | 正常顯示 | ? Pass / ? Fail | |
| 自動啟動排程 | 排程器啟動 | ? Pass / ? Fail | |

## ?? 修正總結

### 關鍵修改
1. ? 加入 `ShowInTaskbar = false` 移除工作列圖示
2. ? 恢復時設定 `ShowInTaskbar = true` 重新顯示圖示
3. ? 保持 `Hide()` 隱藏視窗
4. ? 托盤氣泡通知顯示詳細狀態

### 效果
- 視窗真正「消失」，不留在工作列
- 只保留系統托盤圖示
- 使用者體驗更符合預期
- 狀態資訊更清楚明確

---

**請按照以上步驟進行測試，並回報結果！**
