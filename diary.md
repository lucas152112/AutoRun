# 開發日誌

日期: 2025-01-20

## 目標
- 開發一個可設定定時啟動外部程式的 Windows Forms 工具。
- 每個設定包含：名稱、程式完整路徑、參數、時間設定（一時段，HH:mm）、週期（一週或選擇多個）、啟用/停用。
- 設定可儲存與載入（JSON）。
- 提供清單顯示、編輯、可新增/刪除，且可啟動排程器自動執行，顯示執行紀錄。

## 最新變更 (2025-01-20)

### 5. 輸入欄位權限控制
- **啟動時禁用所有輸入欄位**:
  - 程式啟動時，所有輸入欄位（名稱、程式、參數、時間、星期等）都處於禁用狀態
  - 「加入/更新」按鈕也處於禁用狀態
  - 避免使用者誤操作或不清楚要做什麼

- **明確的操作流程**:
  - **按下「新增」按鈕** → 啟用所有輸入欄位，清空內容，準備新增
  - **點選 Grid 中的項目** → 啟用所有輸入欄位，載入該項目資料，準備編輯
  - **刪除項目後** → 禁用所有輸入欄位，清空內容
  - **取消選擇** → 禁用所有輸入欄位

- **改善的使用者體驗**:
  - 使用者清楚知道何時可以輸入
  - 避免在沒有選擇任何項目時誤輸入資料
  - 操作流程更加直觀和安全

### 1. Grid 欄位優化
- **名稱欄位**: 從自動填滿改為固定 150px，避免佔用過多空間
- **程式欄位**: 改為自動填滿剩餘空間，可完整顯示長路徑
- **週期欄位**: 
  - 從 80px 拉長到 120px
  - 標題從「星期」改為「週期」
  - 優化顯示邏輯：選擇全部 7 天時顯示「每天」，而非「一,二,三,四,五,六,日」

### 2. 使用者體驗改善
- **不預設顯示第一筆資料**: 
  - 程式啟動時，Grid 顯示所有排程項目
  - 但不會預設選中第一筆
  - 輸入欄位處於禁用狀態，等待使用者操作
  - 只有當使用者按下「新增」或在 Grid 中點選項目時，才會啟用輸入欄位
  
- **清晰的操作流程**:
  - 點選 Grid 項目 → 啟用輸入欄位 → 載入資料（編輯模式）
  - 點選「新增」按鈕 → 啟用輸入欄位 → 清空欄位（新增模式）
  - 點選「加入/更新」→ 根據 `_selected` 狀態決定新增或更新
  - 刪除項目或取消選擇 → 禁用輸入欄位

### 3. 程式碼清理
- 移除所有 debug 日誌輸出（`LogDebug`、`LogError` 方法）
- 移除 `BindingList.ListChanged` 空事件處理器
- 簡化程式碼，提升可維護性

### 4. Bug 修正
- 修正 `LoadToInputs` 方法中的打字錯誤（`clkSat` → `chkSat`）
- 確保預設勾選「每天」，避免使用者忘記選擇導致無法新增

## 初始開發內容

### 變更記錄
- 新增 `ScheduleItem`：排程項目資料模型（包含所有屬性）。
- 新增 `SchedulerService`：背景排程器，每 5 秒檢查，且以工作項目作為比對避免相同時段多次啟動，避免程式啟動過於頻繁。
- 新增 `Storage`：以 JSON 儲存/載入 `setting.json`。
- 設計 `Form1` UI 與邏輯：新增/編輯/刪除/清單、儲存、啟動/停止排程器、顯示執行紀錄。

### 測試情況
- 編譯：Build 成功（.NET 8, Windows Forms）。
- 啟動測試：
  1) 新增一個設定：
     - 名稱: 記事本
     - 程式: notepad.exe
     - 參數: 留空
     - 時間: 設為當前時間相同或稍後（例如現在 14:35，設定 14:35）
     - 週期: 勾選每天
     - 啟用: 勾選
     點「加入/更新」，清單顯示該筆正確。
  2) 點「儲存」，測試停用，設定成功留存（JSON 載入正確）。
  3) 勾選「啟動排程器」，等待時間到達，彈出視窗顯示啟動訊息且成功開啟 notepad。
  4) 測試「停用」，相同設定，到達時間了，不觸發。恢復啟用，下一個設定的時間可以，即觸發。
  5) 修改時間與參數後更新，下一個符合時間觸發後會依新的參數。
  6) 刪除設定，並確認儲存檔案後重啟，該筆不存在，表現正常。
- 邊界檢查：
  - 未輸入名稱/程式或未勾選週期會顯示提示訊息。
  - 每個設定可同時有多筆，避免多次啟動。

結果：基本通過，功能符合需求（單一時段分鐘）。

### 已知限制
- 使用本地時間，不處理時區/日光節約時間。
- 不檢查檔案是否存在或錯誤只觸發。

### 後續可擴充
- 系統匣最小化與開機自動啟動。
- 設定匯入/匯出與程式路徑瀏覽。
- 將排程歷史寫入日誌與完整錯誤處理。

## 檔案結構
```
AutoRun/
├── Form1.cs               # 主要表單邏輯
├── Form1.Designer.cs      # 表單設計器檔案
├── Form1.resx            # 表單資源檔
├── ScheduleItem.cs       # 排程項目資料模型
├── SchedulerService.cs   # 排程服務
├── Storage.cs            # 儲存與載入服務
├── AppSettings.cs        # 應用程式設定
├── setting.json          # 排程設定檔（執行時生成）
└── settings.json         # 應用程式設定檔（執行時生成）
```

## 技術細節
- **Framework**: .NET 8, Windows Forms
- **資料綁定**: 使用 `BindingList<T>` 和 `BindingSource` 實現雙向綁定
- **UI 組件**: DataGridView, DateTimePicker, CheckBox, TextBox, Button
- **儲存格式**: JSON (使用 System.Text.Json)
- **排程檢查**: 每 5 秒檢查一次
- **執行防護**: 同一時段相同項目只執行一次

## 版本歷史
- **v1.0** (2025-01-13): 初始版本，基本排程功能
- **v1.1** (2025-01-20): UI 優化、移除 debug 日誌、改善使用者體驗
